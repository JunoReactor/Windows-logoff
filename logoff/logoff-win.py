import os
import time
import ctypes
import random
import datetime
from win10toast import ToastNotifier

# 2 часа = 7200, 1 час = 3600
# default: 3600
playTime = 3600
# Ждем 2 минуты = 120 перед выключением ПК
# default: 120
waitingTime = 120
# Задержка всплывающих сообщений
# default: 160
durationTime = 160 
# Задержка, спам сообщений когда время закончилось
# default: 20
spamMsgTime = 20 
# Тестовый режим - True (ПК не будет выключаться)
# Продуктовый режим - False
# default: True
TestMode = False

# Проверяем, находится ли текущее время в интервале с 23:00 до 6:00
# Ночное время "от"
# default: 23
nightFrom = 23
# Ночное время "до"
# default: 6
nightTo = 6

halfPlayTime = playTime/2

# Получаем текущее время
current_time = time.localtime()
current_hour = current_time.tm_hour
toaster = ToastNotifier()

# Скрываем окно терминала
ctypes.windll.user32.ShowWindow(ctypes.windll.kernel32.GetConsoleWindow(), 0)

def generateRandomMessage():
    messages = [
        "Ты слишком долго работаешь, отдохни немного.",
        "Возьми небольшой перерыв и расслабься.",
        "Твой мозг нуждается в отдыхе, не забудь сделать перерыв.",
        "Заботься о своем здоровье, сделай небольшую паузу.",
        "Помните, что перерывы в работе за компьютером помогают сохранить здоровье и продуктивность.",
        "Регулярные перерывы от работы за компьютером помогают снять напряжение и улучшить концентрацию.",
        "Делайте уроки в перерывах между работой за компьютером - это поможет эффективно использовать время.",
        "Не забывайте делать упражнения для глаз во время перерывов от компьютера - это поможет снизить нагрузку на глаза.",
        "Перерывы в работе за компьютером также способствуют поддержанию физической активности.",
        "Поставьте напоминание о перерывах в работе за компьютером, чтобы не забывать делать упражнения и уроки.",
        "Перерывы от работы за компьютером помогают снять усталость и восстановить энергию.",
        "Регулярные перерывы от работы за компьютером позволяют избежать проблем со спиной и шеей.",
        "Используйте перерывы от работы за компьютером для того, чтобы провести время на свежем воздухе и расслабиться.",
        "Помните, что делать уроки в перерывах от работы за компьютером поможет вам эффективно использовать свое время.",
        "Не забывайте делать растяжку во время перерывов от компьютера - это поможет снять напряжение в мышцах.",
        "Перерывы от работы за компьютером способствуют улучшению кровообращения и предотвращению проблем с сердцем.",
        "Делайте уроки в перерывах между работой за компьютером, чтобы эффективно использовать свое время и развиваться.",
        "Помните, что перерывы от работы за компьютером помогают предотвратить развитие синдрома запястья.",
        "Регулярные перерывы от работы за компьютером способствуют улучшению памяти и концентрации.",
        "Используйте перерывы от работы за компьютером для того, чтобы пообщаться с коллегами или друзьями.",
        "Поставьте напоминание о перерывах в работе за компьютером, чтобы не забывать делать упражнения и уроки.",
        "Перерывы от работы за компьютером помогают снизить риск развития проблем со зрением.",
        "Регулярные перерывы от работы за компьютером способствуют повышению эффективности и качества работы.",
        "Не забывайте делать упражнения для шеи и спины во время перерывов от компьютера - это поможет предотвратить боли.",
        "Перерывы в работе за компьютером помогают сохранять мотивацию и предотвращать усталость.",
        "Делайте уроки в перерывах между работой за компьютером - это поможет развивать свои навыки.",
        "Поставьте напоминание о перерывах в работе за компьютером, чтобы не забывать делать упражнения и уроки.",
        "Перерывы от работы за компьютером способствуют расслаблению мышц и снятию стресса.",
        "Регулярные перерывы от работы за компьютером помогают сохранять энергию и продуктивность на протяжении дня.",
        "Используйте перерывы от работы за компьютером для того, чтобы провести время с семьей или друзьями.",
        "Помните, что делать уроки в перерывах от работы за компьютером поможет вам развиваться и достигать своих целей.",
        "Перерывы от работы за компьютером помогают снизить риск развития проблем с позвоночником.",
        "Регулярные перерывы от работы за компьютером способствуют улучшению настроения и благополучия.",
        "Не забывайте делать глубокий вдох и выдох во время перерывов от компьютера - это поможет снять стресс.",
        "Перерывы от работы за компьютером способствуют улучшению фокусировки и концентрации внимания.",
        "Делайте уроки в перерывах между работой за компьютером - это поможет расширить свои знания и навыки.",
        "Поставьте напоминание о перерывах в работе за компьютером, чтобы не забывать делать упражнения и уроки.",
        "Перерывы от работы за компьютером помогают снизить риск развития проблем с плечами и шеей.",
        "Регулярные перерывы от работы за компьютером способствуют повышению творческого потенциала.",
        "Используйте перерывы от работы за компьютером для того, чтобы почитать книгу или послушать аудиокнигу.",
        "Помните, что делать уроки в перерывах от работы за компьютером поможет вам развиваться личностно.",
        "Перерывы от работы за компьютером помогают снять напряжение в мышцах шеи и спины.",
        "Регулярные перерывы от работы за компьютером способствуют повышению эффективности обучения.",
        "Не забывайте делать гимнастику для рук во время перерывов от компьютера - это поможет предотвратить синдром карпального тоннеля.",
        "Перерывы в работе за компьютером помогают сохранять равновесие между работой и учебой.",
        "Делайте уроки в перерывах между работой за компьютером - это поможет вам эффективно использовать свое время.",
        "Поставьте напоминание о перерывах в работе за компьютером, чтобы не забывать делать упражнения и уроки.",
        "Перерывы от работы за компьютером способствуют повышению креативности и инновационного мышления.",
        "Регулярные перерывы от работы за компьютером помогают сохранять баланс между физическим и умственным здоровьем.",
        "Используйте перерывы от работы за компьютером для того, чтобы посмотреть образовательное видео или прочитать статью на интересующую тему.",
        "Помните, что делать уроки в перерывах от работы за компьютером поможет вам развиваться как личность.",
        "Перерывы от работы за компьютером помогают снизить риск развития проблем со спиной и глазами.",
        "Регулярные перерывы от работы за компьютером способствуют повышению самодисциплины и самоорганизации.",
        "Не забывайте делать гимнастику для глаз во время перерывов от компьютера - это поможет поддерживать здоровье глазной системы.",
        "Перерывы от работы за компьютером способствуют повышению качества сна и отдыха.",
        "Делайте уроки в перерывах между работой за компьютером - это поможет вам расширить свои знания и навыки.",
        "Поставьте напоминание о перерывах в работе за компьютером, чтобы не забывать делать упражнения и уроки.",
        "Перерывы от работы за компьютером помогают снять усталость глаз и предотвратить развитие проблем со зрением.",
        "Регулярные перерывы от работы за компьютером способствуют повышению продуктивности и эффективности обучения.",
        "Используйте перерывы от работы за компьютером для того, чтобы провести время на свежем воздухе или заняться физическими упражнениями.",
        "Помните, что делать уроки в перерывах от работы за компьютером поможет вам достигать успехов в обучении.",
        "Перерывы от работы за компьютером помогают снизить риск развития проблем со спиной и шеей.",
        "Регулярные перерывы от работы за компьютером способствуют повышению мотивации и энтузиазма к обучению.",
        "Не забывайте делать гимнастику для шеи и плеч во время перерывов от компьютера - это поможет предотвратить напряжение.",
        "Перерывы в работе за компьютером помогают сохранять баланс между физической активностью и интеллектуальной нагрузкой.",
        "Делайте уроки в перерывах между работой за компьютером - это поможет вам развиваться как личность.",
        "Поставьте напоминание о перерывах в работе за компьютером, чтобы не пропустить время для упражнений и уроков.",
        "Перерывы от работы за компьютером способствуют повышению качества мышления и решения проблем.",
        "Регулярные перерывы от работы за компьютером помогают сохранять энтузиазм к обучению и достижению целей.",
        "Используйте перерывы от работы за компьютером для того, чтобы почитать книгу или послушать аудиокнигу по интересующей вас теме.",
        "Помните, что делать уроки в перерывах от работы за компьютером поможет вам расширить свои знания и навыки.",
        "Перерывы от работы за компьютером помогают снизить риск развития проблем с позвоночником и глазами.",
        "Регулярные перерывы от работы за компьютером способствуют повышению самодисциплины и самоконтроля.",
        "Не забывайте делать гимнастику для глаз во время перерывов от компьютера - это поможет сохранить здоровье глазной системы.",
        "Перерывы от работы за компьютером способствуют повышению качества мышления и концентрации на задачах обучения.",
        "Делайте уроки в перерывах между работой за компьютером - это поможет эффективно использовать свое время и достигать успехов в обучении.",
        "Поставьте напоминание о перерывах в работе за компьютером, чтобы не забывать делать упражнения и учебные задания.",
        "Перерывы от работы за компьютером помогают снять напряжение мышц шеи и спины, предотвращая возникновение болей.",
        "Регулярные перерывы от работы за компьютером способствуют повышению продуктивности и эффективности обучения.",
        "Используйте перерывы от работы за компьютером для того, чтобы провести время на свежем воздухе или заняться физическими упражнениями для поддержания физической активности.",
        "Помните, что делать уроки в перерывах от работы за компьютером поможет вам развиваться как личность и достигать успехов в обучении.",
        "Перерывы от работы за компьютером помогают снизить риск развития проблем со зрением и позвоночником, связанных с длительным пребыванием перед экранами.",
        "Регулярные перерывы от работы за компьютером способствуют повышению мотивации к обучению и достижению поставленных целей.",
        "Не забудьте выполнять гимнастику для рук и пальцев во время перерывов от использования компьютера - это поможет предотвратить развитие синдрома карпального тоннеля.",
        "Проведение перерывов при работе на компьютере является необходимостью для поддержания физического и психологического благополучия.",
        "Помните, что перерывы от работы за компьютером помогают предотвратить синдром запястья.",
        "Планируйте свои перерывы от работы за компьютером заранее, чтобы они были регулярными и эффективными.",
        "Во время перерывов от работы за компьютером, занимайтесь упражнениями для спины и шеи, чтобы снять напряжение.",
        "Используйте технику \"20-20-20\": каждые 20 минут работы за компьютером делайте перерыв на 20 секунд и смотрите на объект, находящийся на расстоянии 20 футов от вас.",
        "Помните, что перерывы от работы за компьютером помогают улучшить кровообращение и предотвратить скопление сгустков крови в ногах.",
        "Запланируйте время для уроков и перерывов в своем расписании работы за компьютером, чтобы не забывать о них.",
        "Перерывы от работы за компьютером помогают снять стресс и улучшить общее самочувствие.",
        "Поставьте себе цель - выполнить определенное количество заданий или уроков во время каждого перерыва от работы за компьютером.",
        "Не забывайте делать глубокие вдохи и выдохи во время перерывов от компьютера - это поможет восстановить энергию и улучшить кислородный обмен.",
        "Проведите время на природе во время перерывов от работы за компьютером - это поможет расслабиться и освежиться.",
        "Включите в свою рутину перерывы от работы за компьютером, чтобы поддерживать баланс между работой и учебой.",
        "Перерывы от работы за компьютером помогают улучшить фокус и концентрацию при выполнении уроков.",
        "Используйте технику \"помидора\": работайте 25 минут, затем делайте перерыв в течение 5 минут, повторяйте этот цикл несколько раз, чтобы эффективно использовать время на уроки и работу за компьютером.",
        "Позвольте себе небольшие награды после каждого завершенного урока во время перерывов от работы за компьютером - это поможет вам оставаться мотивированным.",
        "Не забывайте пить достаточное количество воды во время перерывов от работы за компьютером - это поможет поддерживать гидратацию и общее самочувствие.",
        "Включите в свою рутину физические упражнения во время перерывов от работы за компьютером - это поможет улучшить физическую форму и здоровье.",
        "Поставьте цели для каждого перерыва от работы за компьютером, чтобы эффективно использовать время на уроки и задания.",
        "Не забывайте делать растяжку для рук и плеч во время перерывов от компьютера - это поможет предотвратить мышечное напряжение.",
        "Проведите время на свежем воздухе во время перерывов от работы за компьютером - это поможет освежиться и повысить энергию.",
        "Используйте технику \"пяти минут\": каждые 45 минут работы за компьютером делайте перерыв на 5 минут, чтобы отдохнуть и собраться с мыслями перед продолжением уроков.",
        "Позвольте себе достаточно времени на сон и отдых после работы за компьютером и уроков - это поможет восстановиться и подготовиться к следующему дню.",
        "Используйте технику \"белого шума\": включите специальные звуковые треки или приложения, которые помогут создать расслабляющую атмосферу во время перерывов от работы за компьютером и уроков.",
        "Не забывайте делать гимнастику для глаз во время перерывов от компьютера - это поможет снять напряжение и улучшить зрение.",
        "Запланируйте свои уроки так, чтобы они попадали на перерывы от работы за компьютером - это поможет эффективно использовать свое время.",
        "Поставьте перед собой маленькие цели на каждый перерыв от работы за компьютером, чтобы чувствовать прогресс в учебе.",
        "Включите музыку или аудиокниги во время перерывов от работы за компьютером - это поможет расслабиться и развлечься.",
        "Установите на компьютер специальные программы или расширения, которые будут напоминать о необходимости делать перерывы от работы и учебы.",
        "Не забывайте принимать правильную осанку во время работы за компьютером и учебы - это поможет предотвратить проблемы со спиной.",
        "Проведите время с семьей или друзьями во время перерывов от работы за компьютером - это поможет расслабиться и получить эмоциональную поддержку.",
        "Используйте технику \"глубокого дыхания\": сделайте несколько глубоких вдохов и выдохов во время перерывов от компьютера, чтобы снять стресс и повысить концентрацию.",
        "Запланируйте время для саморазвития и чтения книг во время перерывов от работы за компьютером - это поможет расширить кругозор и получить новые знания.",
        "Не забывайте делать паузы и прогулки в течение дня, чтобы размяться и освежиться перед продолжением работы за компьютером и учебы.",
        "Поставьте перед собой четкие цели для каждого перерыва от работы за компьютером - это поможет вам оставаться мотивированным и продуктивным.",
        "Включите приложения для медитации или релаксации во время перерывов от работы за компьютером - это поможет снять стресс и успокоиться.",
        "Не забывайте делать физические упражнения для спины и шеи во время перерывов от компьютера - это поможет предотвратить боли и напряжение.",
        "Организуйте свое рабочее пространство таким образом, чтобы было комфортно работать за компьютером и делать уроки без лишнего напряжения.",
        "Поставьте перед собой временные ограничения на работу за компьютером, чтобы выделить достаточно времени на уроки и саморазвитие.",
        "Не забывайте делать гимнастику для рук и пальцев во время перерывов от компьютера - это поможет предотвратить мышечное напряжение.",
        "Проведите время на чтение или изучение новых материалов во время перерывов от работы за компьютером - это поможет расширить свои знания.",
        "Используйте технику \"позитивного мышления\": во время перерывов от работы за компьютером повторяйте положительные утверждения или аффирмации, чтобы поддерживать хорошее настроение.",
        "Запланируйте свое рабочее время так, чтобы оставалось достаточно времени на уроки и саморазвитие без чрезмерных нагрузок.",
        "Не забывайте делать гимнастику для ног и ступней во время перерывов от компьютера - это поможет улучшить кровообращение и предотвратить отеки ног.",
        "Поставьте перед собой маленькие цели для каждого перерыва от работы за компьютером, чтобы чувствовать прогресс и достигать результатов.",
        "Включите свежий воздух или ароматические масла в свое рабочее пространство, чтобы создать приятную атмосферу во время перерывов от работы за компьютером и учебы.",
        "Не забывайте делать паузы для еды и питья в течение дня, чтобы поддерживать энергию и концентрацию при работе за компьютером и выполнении уроков.",
        "Организуйте свое рабочее пространство таким образом, чтобы было комфортно работать за компьютером и делать уроки без лишнего напряжения на глаза.",
        "Поставьте перед собой четкий график для каждого дня, чтобы выделить достаточно времени на работу, учебу и отдых.",
        "Не забывайте делать гимнастику для шеи и плеч во время перерывов от компьютера - это поможет предотвратить мышечное напряжение.",
        "Проведите время на общение с близкими людьми или друзьями во время перерывов от работы за компьютером - это поможет расслабиться и получить эмоциональную поддержку.",
        "Используйте технику \"самодисциплины\": поставьте перед собой жесткие временные рамки для работы за компьютером и выполнения уроков, чтобы избежать прокрастинации.",
        "Запланируйте свое рабочее время так, чтобы оставалось достаточно времени на уроки и саморазвитие без чрезмерной загрузки.",
        "Не забывайте делать гимнастику для спины и позвоночника во время перерывов от компьютера - это поможет предотвратить боли и напряжение.",
        "Поставьте перед собой маленькие цели для каждого перерыва от работы за компьютером, чтобы чувствовать прогресс в учебе и работе.",
        "Включите музыку или звуки природы во время перерывов от работы за компьютером - это поможет создать расслабляющую атмосферу и повысить концентрацию.",
        "Не забывайте делать гимнастику для глаз во время перерывов от компьютера - это поможет снять напряжение и сохранить зрение.",
        "Организуйте свое рабочее пространство таким образом, чтобы было комфортно работать за компьютером и делать уроки без лишнего напряжения на шею и спину.",
        "Поставьте перед собой четкий план действий на каждый день, чтобы небыть нубищей."
    ]
    return random.choice(messages)

def killProcess():
    os.system('taskkill /IM steam.exe /F')
    os.system('taskkill /IM chrome.exe /F')
    os.system('taskkill /IM Discord.exe /F')

# Разлогиниваем пользователя
def logOff():
    if(TestMode == False):
        os.system('logoff')
        os.system('shutdown /l')
    else:
        os.system('msg * Разлогинивание: тест')

# Выключаем ПК
def shutdown():
    if(TestMode == False):
        os.system('shutdown /s /t 0')
    else:
        os.system('msg * Выключение: тест')

def notice(title, message):
    if title == "":
        title = "Уведомление"
    #toaster.show_toast(title, message)
    os.system(f'msg * {message}')

def sleep(sleep):
    time.sleep(sleep)

now = datetime.datetime.now()
messageNow = f'Я слежу за тобой. Сейчас {now:%H:%M}, доступное время для игры: {playTime} мин.'
notice("Уведомление", messageNow)

if current_hour >= nightFrom or current_hour < nightTo:
    notice("Уведомление", "Время спать, а не играть!")
    notice("Уведомление", "Так как уже очень поздно и вам надо отдыхать, ПК будет автоматически выключен через 2 минуты. Сохраните свою работу.")
    
    sleep(waitingTime)
    
    notice("Уведомление", "Компьютер ложится спать. Спокойной ночи :-)")
    killProcess()
    sleep(5)
    shutdown()
else:
    notice("Уведомление", "Твое время пошло, можешь играть!")
    sleep(halfPlayTime)
    notice("Уведомление", "Половина времени прошла")
    sleep(halfPlayTime)
    notice("Уведомление", "Время вышло!")
    notice("Уведомление","Время вышло, иди отдохни!")
    
    killProcess()
    logOff()

    while True:
        if ctypes.windll.user32.GetForegroundWindow() != 0:
            sleep(spamMsgTime)
            message = generateRandomMessage()
            notice("Уведомление",message)
            notice("Заканчивай", "Время вышло!")
            killProcess()
            sleep(5)
            logOff()
